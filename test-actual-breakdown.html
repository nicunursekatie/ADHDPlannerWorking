<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Actual Breakdown Component</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .console { background: #f5f5f5; padding: 10px; font-family: monospace; white-space: pre-wrap; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; cursor: pointer; margin: 5px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Test Actual AI Breakdown Component</h1>
    
    <div class="test-section">
        <h2>Console Output</h2>
        <div id="console-output" class="console"></div>
    </div>
    
    <div class="test-section">
        <h2>Actions</h2>
        <button onclick="testFullWorkflow()">Test Full Workflow</button>
        <button onclick="clearConsole()">Clear Console</button>
    </div>

    <script>
        function log(message, type = 'info') {
            const output = document.getElementById('console-output');
            const timestamp = new Date().toISOString().split('T')[1].split('.')[0];
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            output.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            output.scrollTop = output.scrollHeight;
        }

        function clearConsole() {
            document.getElementById('console-output').innerHTML = '';
        }

        async function testFullWorkflow() {
            log('Starting full workflow test...');
            
            // Simulate initial component state
            let state = {
                showContextForm: true,
                breakdownOptions: [],
                isLoading: false,
                error: null,
                contextData: {}
            };
            
            log(`Initial state: ${JSON.stringify(state)}`);
            log('Component shows: Context form');
            
            // Step 1: User fills context form and clicks submit
            await new Promise(resolve => setTimeout(resolve, 500));
            log('\n--- User fills context form and clicks "Create Personalized Breakdown" ---');
            
            state.contextData = {
                currentState: 'Have laundry basket full',
                blockers: 'Don\'t know where items go',
                specificGoal: 'Get laundry put away',
                environment: 'Small apartment'
            };
            state.showContextForm = false;
            state.isLoading = true;
            
            log(`State after form submission: ${JSON.stringify(state)}`);
            log('Component shows: Loading...');
            log('useEffect triggers generateBreakdown()');
            
            // Step 2: API call simulation
            await new Promise(resolve => setTimeout(resolve, 1000));
            log('\n--- API Response Processing ---');
            
            // Simulate Groq response
            const groqResponse = [
                { Step: "Put away items that already have homes" },
                { Step: "Group similar items into containers" },
                { Step: "Create temporary spots for undecided items" }
            ];
            
            log('Raw Groq response: ' + JSON.stringify(groqResponse));
            
            // Apply conversion logic
            const convertedSteps = groqResponse.map((step, index) => ({
                id: `${index + 1}`,
                title: step.Step || `Step ${index + 1}`,
                duration: '5-10 mins',
                description: step.Step || `Step ${index + 1}`,
                selected: true,
                editable: false,
                type: 'work',
                energyRequired: 'medium',
                tips: 'Focus on this specific action'
            }));
            
            log('Converted steps: ' + JSON.stringify(convertedSteps[0]));
            
            state.breakdownOptions = convertedSteps;
            state.isLoading = false;
            
            log(`\nFinal state: ${JSON.stringify({
                showContextForm: state.showContextForm,
                breakdownOptionsLength: state.breakdownOptions.length,
                isLoading: state.isLoading
            })}`);
            
            // Check render condition
            const shouldShowBreakdown = state.breakdownOptions.length > 0 && !state.showContextForm;
            log(`\nShould show breakdown options: ${shouldShowBreakdown}`, shouldShowBreakdown ? 'success' : 'error');
            
            if (shouldShowBreakdown) {
                log('Component shows: Breakdown options', 'success');
                state.breakdownOptions.forEach((opt, i) => {
                    log(`  ${i + 1}. ${opt.title}`);
                });
            } else {
                log('Component shows: Nothing (ERROR)', 'error');
                log('Debug info:', 'error');
                log(`  - breakdownOptions.length: ${state.breakdownOptions.length}`, 'error');
                log(`  - showContextForm: ${state.showContextForm}`, 'error');
                log(`  - Condition: ${state.breakdownOptions.length} > 0 && !${state.showContextForm} = ${shouldShowBreakdown}`, 'error');
            }
        }
    </script>
</body>
</html>