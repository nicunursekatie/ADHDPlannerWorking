<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Breakdown Render Issue</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .console { background: #f5f5f5; padding: 10px; font-family: monospace; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; cursor: pointer; }
        .breakdown-item { margin: 10px 0; padding: 10px; background: #f0f0f0; }
    </style>
</head>
<body>
    <h1>Test Breakdown Render Issue</h1>
    
    <div class="test-section">
        <h2>Component State Simulation</h2>
        <div id="state-display" class="console"></div>
        <button onclick="simulateContextSubmission()">Simulate Context Form Submission</button>
        <button onclick="simulateAPIResponse()">Simulate API Response</button>
    </div>
    
    <div class="test-section">
        <h2>Render Conditions</h2>
        <div id="render-check" class="console"></div>
    </div>
    
    <div class="test-section">
        <h2>Simulated Component Output</h2>
        <div id="component-output"></div>
    </div>

    <script>
        let state = {
            showContextForm: true,
            breakdownOptions: [],
            isLoading: false,
            error: null,
            contextData: {
                currentState: '',
                blockers: '',
                specificGoal: '',
                environment: ''
            }
        };

        function updateDisplay() {
            document.getElementById('state-display').innerHTML = `
                showContextForm: ${state.showContextForm}<br>
                breakdownOptions.length: ${state.breakdownOptions.length}<br>
                isLoading: ${state.isLoading}<br>
                error: ${state.error}<br>
                contextData: ${JSON.stringify(state.contextData)}
            `;
            
            // Check render conditions
            const shouldShowContext = state.showContextForm && !state.isLoading;
            const shouldShowOptions = state.breakdownOptions.length > 0 && !state.showContextForm;
            
            document.getElementById('render-check').innerHTML = `
                Should show context form: ${shouldShowContext}<br>
                Should show breakdown options: ${shouldShowOptions}<br>
                Condition check: breakdownOptions.length (${state.breakdownOptions.length}) > 0 && !showContextForm (${!state.showContextForm})
            `;
            
            // Simulate component output
            let output = '';
            if (shouldShowContext) {
                output = '<div class="breakdown-item">Context Form</div>';
            } else if (shouldShowOptions) {
                output = state.breakdownOptions.map(opt => 
                    `<div class="breakdown-item">${opt.title}</div>`
                ).join('');
            } else if (state.isLoading) {
                output = '<div class="breakdown-item">Loading...</div>';
            } else {
                output = '<div class="breakdown-item">No content to display</div>';
            }
            
            document.getElementById('component-output').innerHTML = output;
        }

        function simulateContextSubmission() {
            console.log('Simulating context form submission');
            state.contextData = {
                currentState: 'Have items scattered',
                blockers: 'Don\'t know where things go',
                specificGoal: 'Clear the desk',
                environment: 'Small room'
            };
            state.showContextForm = false;
            state.isLoading = true;
            updateDisplay();
            
            // Simulate useEffect triggering generateBreakdown
            setTimeout(() => {
                console.log('UseEffect would trigger generateBreakdown here');
                simulateAPIResponse();
            }, 100);
        }

        function simulateAPIResponse() {
            console.log('Simulating API response');
            state.isLoading = false;
            state.breakdownOptions = [
                { id: '1', title: 'Clear items with known homes first', selected: true },
                { id: '2', title: 'Group similar items together', selected: true },
                { id: '3', title: 'Create temporary holding area', selected: true }
            ];
            updateDisplay();
        }

        // Initial display
        updateDisplay();
    </script>
</body>
</html>